!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){i(1),i(2),i(3),i(4),i(5),i(6),i(7),t.exports=i(8)},function(t,e){const i=function(){return 2===arguments.length&&Array.from(arguments).every(function(t){return i.isUsefulInteger(t)})?new i.Circuit(arguments[0],arguments[1]):i.Circuit.fromText(arguments[0])};Object.assign(i,{verbosity:.5,log:function(t,...e){return i.verbosity>=t&&console.log(...e),"(log)"},warn:function(){return console.warn(...arguments),"(warn)"},error:function(){return console.error(...arguments),"(error)"},extractDocumentation:function(t){const e=(t=t.toString()).indexOf("`")+1,i=t.indexOf("`",e),n=t.substring(e,i).split("\n");let r=Number.MAX_SAFE_INTEGER;return n.forEach(function(t){if(t){const e=function(t){let e=index=0;for(;"\t"===t.charAt(index++);)e++;return e}(t);r>e&&(r=e)}}),n.forEach(function(t,e){""===t.trim()&&(t="\n\n"),n[e]=t.substring(r).replace(/ {2}$/,"\n")}),n.join("")},help:function(t){return void 0===t&&(t=i),i.extractDocumentation(t)},constants:{},createConstant:function(t,e){this[t]=e,this.constants[t]=this[t],Object.freeze(this[t])},createConstants:function(){if(arguments.length%2!=0)return i.error("Q attempted to create constants with invalid (KEY, VALUE) pairs.");for(let t=0;t<arguments.length;t+=2)this.createConstant(arguments[t],arguments[t+1])},isUsefulNumber:function(t){return!1===isNaN(t)&&("number"==typeof t||t instanceof Number)&&t!==1/0&&t!==-1/0},isUsefulInteger:function(t){return i.isUsefulNumber(t)&&Number.isInteger(t)},loop:function(){},hypotenuse:function(t,e){let i=Math.abs(t),n=Math.abs(e);return i<2048&&n<2048?Math.sqrt(i*i+n*n):(i<n?(i=n,n=t/e):n=e/t,i*Math.sqrt(1+n*n))},logHypotenuse:function(t,e){const i=Math.abs(t),n=Math.abs(e);return 0===t?Math.log(n):0===e?Math.log(i):i<2048&&n<2048?Math.log(t*t+e*e)/2:Math.log(t/Math.cos(Math.atan2(e,t)))},hyperbolicSine:function(t){return(Math.exp(t)-Math.exp(-t))/2},hyperbolicCosine:function(t){return(Math.exp(t)+Math.exp(-t))/2},round:function(t,e){"number"!=typeof e&&(e=0);const i=Math.pow(10,e);return Math.round(t*i)/i},toTitleCase:function(t){return(t=t.replace(/_/g," ")).toLowerCase().split(" ").map(function(t){return t.replace(t[0],t[0].toUpperCase())}).join(" ")},centerText:function(t,e,i){if(e>t.length){"string"!=typeof i&&(i=" ");const n=Math.floor((e-t.length)/2);t.length;return t.padStart(n+t.length,i).padEnd(e,i)}return t},namesIndex:0,shuffledNames:[],shuffleNames$:function(){let t=[];for(let e=0;e<i.COLORS.length;e++)for(let n=0;n<i.ANIMALS.length;n++)t.push([e,n,Math.random()]);i.shuffledNames=t.sort(function(t,e){return t[2]-e[2]})},getRandomName$:function(){0===i.shuffledNames.length&&i.shuffleNames$();const t=i.shuffledNames[i.namesIndex],e=i.COLORS[t[0]]+" "+i.ANIMALS[t[1]];return i.namesIndex=(i.namesIndex+1)%i.shuffledNames.length,e},hueToColorName:function(t){return t%=360,t=Math.floor(t/10),i.COLORS[t]},colorIndexToHue:function(t){return 10*t}}),i.createConstants("REVISION",19,"EPSILON",6*Number.EPSILON,"RADIANS_TO_DEGREES",180/Math.PI,"ANIMALS",["Aardvark","Albatross","Alligator","Alpaca","Ant","Anteater","Antelope","Ape","Armadillo","Baboon","Badger","Barracuda","Bat","Bear","Beaver","Bee","Bison","Boar","Buffalo","Butterfly","Camel","Caribou","Cat","Caterpillar","Cattle","Chamois","Cheetah","Chicken","Chimpanzee","Chinchilla","Chough","Clam","Cobra","Cod","Cormorant","Coyote","Crab","Crane","Crocodile","Crow","Curlew","Deer","Dinosaur","Dog","Dogfish","Dolphin","Donkey","Dotterel","Dove","Dragonfly","Duck","Dugong","Dunlin","Eagle","Echidna","Eel","Eland","Elephant","Elephant seal","Elk","Emu","Falcon","Ferret","Finch","Fish","Flamingo","Fly","Fox","Frog","Galago","Gaur","Gazelle","Gerbil","Giant Panda","Giraffe","Gnat","Gnu","Goat","Goose","Goldfinch","Goldfish","Gorilla","Goshawk","Grasshopper","Grouse","Guanaco","Guinea fowl","Guinea pig","Gull","Guppy","Hamster","Hare","Hawk","Hedgehog","Hen","Heron","Herring","Hippopotamus","Hornet","Horse","Human","Hummingbird","Hyena","Ide","Jackal","Jaguar","Jay","Jellyfish","Kangaroo","Koala","Koi","Komodo dragon","Kouprey","Kudu","Lapwing","Lark","Lemur","Leopard","Lion","Llama","Lobster","Locust","Loris","Louse","Lyrebird","Magpie","Mallard","Manatee","Marten","Meerkat","Mink","Mole","Monkey","Moose","Mouse","Mosquito","Mule","Narwhal","Newt","Nightingale","Octopus","Okapi","Opossum","Oryx","Ostrich","Otter","Owl","Ox","Oyster","Panther","Parrot","Partridge","Peafowl","Pelican","Penguin","Pheasant","Pig","Pigeon","Pony","Porcupine","Porpoise","Prairie Dog","Quail","Quelea","Rabbit","Raccoon","Rail","Ram","Raven","Reindeer","Rhinoceros","Rook","Ruff","Salamander","Salmon","Sand Dollar","Sandpiper","Sardine","Scorpion","Sea lion","Sea Urchin","Seahorse","Seal","Shark","Sheep","Shrew","Shrimp","Skunk","Snail","Snake","Sow","Spider","Squid","Squirrel","Starling","Stingray","Stinkbug","Stork","Swallow","Swan","Tapir","Tarsier","Termite","Tiger","Toad","Trout","Tui","Turkey","Turtle","Vicuña","Viper","Vulture","Wallaby","Walrus","Wasp","Water buffalo","Weasel","Whale","Wolf","Wolverine","Wombat","Woodcock","Woodpecker","Worm","Wren","Yak","Zebra"],"ANIMALS3",["ape","bee","cat","dog","elk","fox","gup","hen","ide","jay","koi","leo","moo","nit","owl","pig","ram","sow","tui","yak","zeb"],"COLORS",["Red","Scarlet","Tawny","Carrot","Pumpkin","Mustard","Lemon","Lime","Spring bud","Spring grass","Pear","Kelly","Green","Malachite","Sea green","Sea foam","Aquamarine","Turquoise","Cyan","Pacific blue","Baby blue","Ocean blue","Sapphire","Azure","Blue","Cobalt","Indigo","Violet","Lavender","Purple","Magenta","Hot pink","Fuschia","Ruby","Crimson","Carmine"]),console.log(`\n\n\n  QQQQQQ\nQQ      QQ\nQQ      QQ\nQQ      QQ\nQQ  QQ  QQ\nQQ    QQ \n  QQQQ  ${i.REVISION}    \n\n\n\nhttps://quantumjavascript.app\n\n\n\n`)},function(t,e){Q.ComplexNumber=function(t,e){if(t instanceof Q.ComplexNumber?(e=t.imaginary,t=t.real,Q.warn("Q.ComplexNumber tried to create a new instance with an argument that is already a Q.ComplexNumber — and that’s weird!")):void 0===t&&(t=0),void 0===e&&(e=0),!0!==Q.ComplexNumber.isNumberLike(t)&&!0!==isNaN(t)||!0!==Q.ComplexNumber.isNumberLike(e)&&!0!==isNaN(e))return Q.error("Q.ComplexNumber attempted to create a new instance but the arguments provided were not actual numbers.");this.real=t,this.imaginary=e,this.index=Q.ComplexNumber.index++},Object.assign(Q.ComplexNumber,{index:0,help:function(){return Q.help(this)},constants:{},createConstant:Q.createConstant,createConstants:Q.createConstants,isNumberLike:function(t){return!1===isNaN(t)&&("number"==typeof t||t instanceof Number)},isNaN:function(t){return isNaN(t.real)||isNaN(t.imaginary)},isZero:function(t){return!(0!==t.real&&-0!==t.real||0!==t.imaginary&&-0!==t.imaginary)},isFinite:function(t){return isFinite(t.real)&&isFinite(t.imaginary)},isInfinite:function(t){return!(this.isNaN(t)||this.isFinite(t))},areEqual:function(t,e){return Q.ComplexNumber.operate("areEqual",t,e,function(t,e){return Math.abs(t-e)<Q.EPSILON},function(t,e){return Math.abs(t-e.real)<Q.EPSILON&&Math.abs(e.imaginary)<Q.EPSILON},function(t,e){return Math.abs(t.real-e)<Q.EPSILON&&Math.abs(t.imaginary)<Q.EPSILON},function(t,e){return Math.abs(t.real-e.real)<Q.EPSILON&&Math.abs(t.imaginary-e.imaginary)<Q.EPSILON})},absolute:function(t){return Q.hypotenuse(t.real,t.imaginary)},conjugate:function(t){return new Q.ComplexNumber(t.real,-1*t.imaginary)},operate:function(t,e,i,n,r,o,a){return Q.ComplexNumber.isNumberLike(e)?Q.ComplexNumber.isNumberLike(i)?n(e,i):i instanceof Q.ComplexNumber?r(e,i):Q.error("Q.ComplexNumber attempted to",t,"with the number",e,"and something that is neither a Number or Q.ComplexNumber:",i):e instanceof Q.ComplexNumber?Q.ComplexNumber.isNumberLike(i)?o(e,i):i instanceof Q.ComplexNumber?a(e,i):Q.error("Q.ComplexNumber attempted to",t,"with the complex number",e,"and something that is neither a Number or Q.ComplexNumber:",i):Q.error("Q.ComplexNumber attempted to",t,"with something that is neither a Number or Q.ComplexNumber:",e)},sine:function(t){const e=t.real,i=t.imaginary;return new Q.ComplexNumber(Math.sin(e)*Q.hyperbolicCosine(i),Math.cos(e)*Q.hyperbolicSine(i))},cosine:function(t){const e=t.real,i=t.imaginary;return new Q.ComplexNumber(Math.cos(e)*Q.hyperbolicCosine(i),-Math.sin(e)*Q.hyperbolicSine(i))},arcCosine:function(t){const e=t.real,i=t.imaginary,n=Q.ComplexNumber.squareRoot(new Q.ComplexNumber(i*i-e*e+1,e*i*-2)),r=Q.ComplexNumber.log(new Q.ComplexNumber(n.real-i,n.imaginary+e));return new Q.ComplexNumber(Math.PI/2-r.imaginary,r.real)},arcTangent:function(t){const e=t.real,i=t.imaginary;if(0===e){if(1===i)return new Q.ComplexNumber(0,1/0);if(-1===i)return new Q.ComplexNumber(0,-1/0)}const n=e*e+(1-i)*(1-i),r=Q.ComplexNumber.log(new Q.ComplexNumber((1-i*i-e*e)/n,e/n*-2));return new Q.ComplexNumber(r.imaginary/2,r.real/2)},power:function(t,e){if(Q.ComplexNumber.isNumberLike(t)&&(t=new Q.ComplexNumber(t)),Q.ComplexNumber.isNumberLike(e)&&(e=new Q.ComplexNumber(e)),e.isZero())return Q.ComplexNumber.ONE;if(t.isZero()&&e.real>0&&e.imaginary>=0)return Q.ComplexNumber.ZERO;if(0===e.imaginary){if(t.real>=0&&0===t.imaginary)return new Q.ComplexNumber(Math.pow(t.real,e.real),0);if(0===t.real)switch((e.real%4+4)%4){case 0:return new Q.ComplexNumber(Math.pow(t.imaginary,e.real),0);case 1:return new Q.ComplexNumber(0,Math.pow(t.imaginary,e.real));case 2:return new Q.ComplexNumber(-Math.pow(t.imaginary,e.real),0);case 3:return new Q.ComplexNumber(0,-Math.pow(t.imaginary,e.real))}}const i=Math.atan2(t.imaginary,t.real),n=Q.logHypotenuse(t.real,t.imaginary),r=Math.exp(e.real*n-e.imaginary*i),o=e.imaginary*n+e.real*i;return new Q.ComplexNumber(r*Math.cos(o),r*Math.sin(o))},squareRoot:function(t){const e=new Q.ComplexNumber(0,0),i=Q.ComplexNumber.absolute(t);return t.real>=0?0===t.imaginary?e.real=Math.sqrt(t.real):e.real=Math.sqrt(2*(i+t.real))/2:e.real=Math.abs(t.imaginary)/Math.sqrt(2*(i-t.real)),t.real<=0?e.imaginary=Math.sqrt(2*(i-t.real))/2:e.imaginary=Math.abs(t.imaginary)/Math.sqrt(2*(i+t.real)),t.imaginary<0&&(e.imaginary*=-1),e},log:function(t){return new Q.ComplexNumber(Q.logHypotenuse(t.real,t.imaginary),Math.atan2(t.imaginary,t.real))},multiply:function(t,e){return Q.ComplexNumber.operate("multiply",t,e,function(t,e){return new Q.ComplexNumber(t*e)},function(t,e){return new Q.ComplexNumber(t*e.real,t*e.imaginary)},function(t,e){return new Q.ComplexNumber(t.real*e,t.imaginary*e)},function(t,e){const i=t.real*e.real,n=t.real*e.imaginary,r=t.imaginary*e.real,o=t.imaginary*e.imaginary*-1;return new Q.ComplexNumber(i+o,n+r)})},divide:function(t,e){return Q.ComplexNumber.operate("divide",t,e,function(t,e){return new Q.ComplexNumber(t/e)},function(t,e){return new Q.ComplexNumber(t).divide(e)},function(t,e){return new Q.ComplexNumber(t.real/e,t.imaginary/e)},function(t,e){const i=e.conjugate(),n=t.multiply(i),r=e.multiply(i).real;return n.divide(r)})},add:function(t,e){return Q.ComplexNumber.operate("add",t,e,function(t,e){return new Q.ComplexNumber(t+e)},function(t,e){return new Q.ComplexNumber(e.real+t,e.imaginary)},function(t,e){return new Q.ComplexNumber(t.real+e,t.imaginary)},function(t,e){return new Q.ComplexNumber(t.real+e.real,t.imaginary+e.imaginary)})},subtract:function(t,e){return Q.ComplexNumber.operate("subtract",t,e,function(t,e){return new Q.ComplexNumber(t-e)},function(t,e){return new Q.ComplexNumber(e.real-t,e.imaginary)},function(t,e){return new Q.ComplexNumber(t.real-e,t.imaginary)},function(t,e){return new Q.ComplexNumber(t.real-e.real,t.imaginary-e.imaginary)})}}),Q.ComplexNumber.createConstants("ZERO",new Q.ComplexNumber(0,0),"ONE",new Q.ComplexNumber(1,0),"E",new Q.ComplexNumber(Math.E,0),"PI",new Q.ComplexNumber(Math.PI,0),"I",new Q.ComplexNumber(0,1),"EPSILON",new Q.ComplexNumber(Q.EPSILON,Q.EPSILON),"INFINITY",new Q.ComplexNumber(1/0,1/0),"NAN",new Q.ComplexNumber(NaN,NaN)),Object.assign(Q.ComplexNumber.prototype,{clone:function(){return new Q.ComplexNumber(this.real,this.imaginary)},reduce:function(){return 0===this.imaginary?this.real:this},isNaN:function(t){return Q.ComplexNumber.isNaN(this)},isZero:function(t){return Q.ComplexNumber.isZero(this)},isFinite:function(t){return Q.ComplexNumber.isFinite(this)},isInfinite:function(t){return Q.ComplexNumber.isInfinite(this)},isEqualTo:function(t){return Q.ComplexNumber.areEqual(this,t)},absolute:function(){return Q.ComplexNumber.absolute(this)},conjugate:function(){return Q.ComplexNumber.conjugate(this)},power:function(t){return Q.ComplexNumber.power(this,t)},squareRoot:function(){return Q.ComplexNumber.squareRoot(this)},log:function(){return Q.ComplexNumber.log(this)},multiply:function(t){return Q.ComplexNumber.multiply(this,t)},divide:function(t){return Q.ComplexNumber.divide(this,t)},add:function(t){return Q.ComplexNumber.add(this,t)},subtract:function(t){return Q.ComplexNumber.subtract(this,t)},toText:function(t,e){e=!1===e?"":" ";let i=this.real,n=this.imaginary;"number"!=typeof t&&(t=3);const r=Math.pow(10,t);i=Math.round(i*r)/r,n=Math.round(n*r)/r;let o=Math.abs(i),a=Math.abs(n),s=o.toString(),u=a.toString();return 0===i?n===1/0?e+"∞i":n===-1/0?"-∞i":0===n?e+"0":-1===n?"-i":1===n?e+"i":n>=0?e+u+"i":n<0?"-"+u+"i":u+"i":(i===1/0?s=e+"∞":i===-1/0?s="-∞":i>=0?s=e+s:i<0&&(s="-"+s),n===1/0?s+" + ∞i":n===-1/0?s+" - ∞i":0===n?s:-1===n?s+" - i":1===n?s+" + i":n>0?s+" + "+u+"i":n<0?s+" - "+u+"i":s+" + "+u+"i")},copy$:function(t){return t instanceof Q.ComplexNumber!=!0?Q.error(`Q.ComplexNumber attempted to copy something that was not a complex number in to this complex number #${this.index}.`,this):(this.real=t.real,this.imaginary=t.imaginary,this)},conjugate$:function(){return this.copy$(this.conjugate())},power$:function(t){return this.copy$(this.power(t))},squareRoot$:function(){return this.copy$(this.squareRoot())},log$:function(){return this.copy$(this.log())},multiply$:function(t){return this.copy$(this.multiply(t))},divide$:function(t){return this.copy$(this.divide(t))},add$:function(t){return this.copy$(this.add(t))},subtract$:function(t){return this.copy$(this.subtract(t))}})},function(t,e){Q.Matrix=function(){this.index=Q.Matrix.index++;let t=null;if(1==arguments.length&&Q.ComplexNumber.isNumberLike(arguments[0]))t=arguments[0],this.rows=new Array(t).fill(0).map(function(){return new Array(t).fill(0)});else if(2==arguments.length&&Q.ComplexNumber.isNumberLike(arguments[0])&&Q.ComplexNumber.isNumberLike(arguments[1]))t=arguments[0],this.rows=new Array(arguments[1]).fill(0).map(function(){return new Array(t).fill(0)});else{let e=!1;if(this.rows=Array.from(arguments),this.rows.forEach(function(i){i instanceof Array!=!0&&(i=[i]),null===t?t=i.length:t!==i.length&&(e=!0)}),e)return Q.error(`Q.Matrix found upon initialization that matrix#${this.index} row lengths were not equal. You are going to have a bad time.`,this)}const e=this;this.columns=[];for(let i=0;i<t;i++){const t=[];for(let n=0;n<this.rows.length;n++){const r=e.rows[n][i];if("number"==typeof r)e.rows[n][i]=new Q.ComplexNumber(r);else if(r instanceof Q.ComplexNumber==!1)return Q.error(`Q.Matrix found upon initialization that matrix#${this.index} contained non-quantitative values. A+ for creativity, but F for functionality.`,this);Object.defineProperty(t,n,{get:function(){return e.rows[n][i]},set:function(t){e.rows[n][i]=t}})}this.columns.push(t)}},Object.assign(Q.Matrix,{index:0,help:function(){return Q.help(this)},constants:{},createConstant:Q.createConstant,createConstants:Q.createConstants,isMatrixLike:function(t){return t instanceof this||this.prototype.isPrototypeOf(t)},isWithinRange:function(t,e,i){return"number"==typeof t&&t>=e&&t<=i&&t==parseInt(t)},getWidth:function(t){return t.columns.length},getHeight:function(t){return t.rows.length},haveEqualDimensions:function(t,e){return t.rows.length===e.rows.length&&t.columns.length===e.columns.length},areEqual:function(t,e){return t instanceof Q.Matrix==!0&&(e instanceof Q.Matrix==!0&&(!0===Q.Matrix.haveEqualDimensions(t,e)&&t.rows.reduce(function(t,i,n){return t&&i.reduce(function(t,i,r){return t&&i.isEqualTo(e.rows[n][r])},!0)},!0)))},createSquare:function(t,e){"number"!=typeof t&&(t=2),"function"!=typeof e&&(e=function(){return 0});const i=[];for(let n=0;n<t;n++){const r=[];for(let i=0;i<t;i++)r.push(e(i,n));i.push(r)}return new Q.Matrix(...i)},createZero:function(t){return new Q.Matrix.createSquare(t)},createOne:function(t){return new Q.Matrix.createSquare(t,function(){return 1})},createIdentity:function(t){return new Q.Matrix.createSquare(t,function(t,e){return t===e?1:0})},from:function(t){"string"!=typeof t&&(t="Array");const e=Q.Matrix["from"+t];return t=t.toLowerCase(),"function"!=typeof e?Q.error(`Q.Matrix could not find an importer for “${t}” data.`):e},fromArray:function(t){return new Q.Matrix(...t)},fromXsv:function(t,e,i){"string"!=typeof e&&(e="\n"),"string"!=typeof i&&(i="\t");const n=t.split(e),r=[];return n.forEach(function(t){if(""===(t=t.trim()))return;const e=[];t.split(i).forEach(function(t){e.push(parseFloat(t))}),r.push(e)}),new Q.Matrix(...r)},fromCsv:function(t){return Q.Matrix.fromXsv(t.replace(/\r/g,"\n"),"\n",",")},fromTsv:function(t){return Q.Matrix.fromXsv(t,"\n","\t")},fromHtml:function(t){return Q.Matrix.fromXsv(t.replace(/\r?\n|\r|<tr>|<td>/g,"").replace(/<\/td>(\s*)<\/tr>/g,"</tr>").match(/<table>(.*)<\/table>/i)[1],"</tr>","</td>")},toXsv:function(t,e,i){return t.rows.reduce(function(t,n){return t+e+n.reduce(function(t,e,n){return t+(n>0?i:"")+e.toText()},"")},"")},toCsv:function(t){return Q.Matrix.toXsv(t,"\n",",")},toTsv:function(t){return Q.Matrix.toXsv(t,"\n","\t")},add:function(t,e){return!0!==Q.Matrix.isMatrixLike(t)||!0!==Q.Matrix.isMatrixLike(e)?Q.error("Q.Matrix attempted to add something that was not a matrix."):!0!==Q.Matrix.haveEqualDimensions(t,e)?Q.error(`Q.Matrix cannot add matrix#${t.index} of dimensions ${t.columns.length}x${t.rows.length} to matrix#${e.index} of dimensions ${e.columns.length}x${e.rows.length}.`):new Q.Matrix(...t.rows.reduce(function(t,i,n){return t.push(i.reduce(function(t,i,r){return t.push(i.add(e.rows[n][r])),t},[])),t},[]))},multiplyScalar:function(t,e){return!0!==Q.Matrix.isMatrixLike(t)?Q.error("Q.Matrix attempted to scale something that was not a matrix."):"number"!=typeof e?Q.error(`Q.Matrix attempted to scale this matrix#${t.index} by an invalid scalar: ${e}.`):new Q.Matrix(...t.rows.reduce(function(t,i){return t.push(i.reduce(function(t,i){return t.push(i.multiply(e)),t},[])),t},[]))},multiply:function(t,e){if(!0!==Q.Matrix.isMatrixLike(t)||!0!==Q.Matrix.isMatrixLike(e))return Q.error("Q.Matrix attempted to multiply something that was not a matrix.");if(t.columns.length!==e.rows.length)return Q.error(`Q.Matrix attempted to multiply Matrix#${t.index}(cols==${t.columns.length}) by Matrix#${e.index}(rows==${e.rows.length}) but their dimensions were not compatible for this.`);const i=[];return t.rows.forEach(function(t){const n=[];e.columns.forEach(function(e){const i=new Q.ComplexNumber;e.forEach(function(e,n){i.add$(t[n].multiply(e))}),n.push(i)}),i.push(n)}),new this(...i)},multiplyTensor:function(t,e){if(!0!==Q.Matrix.isMatrixLike(t)||!0!==Q.Matrix.isMatrixLike(e))return Q.error("Q.Matrix attempted to tensor something that was not a matrix.");const i=[],n=t.columns.length*e.columns.length,r=t.rows.length*e.rows.length;for(let o=0;o<r;o++){const r=[];for(let i=0;i<n;i++){const n=Math.floor(i/t.columns.length),a=Math.floor(o/t.rows.length),s=i%e.columns.length,u=o%e.rows.length;r.push(t.rows[a][n].multiply(e.rows[u][s]))}i.push(r)}return new Q.Matrix(...i)}}),Object.assign(Q.Matrix.prototype,{isValidRow:function(t){return Q.Matrix.isWithinRange(t,0,this.rows.length-1)},isValidColumn:function(t){return Q.Matrix.isWithinRange(t,0,this.columns.length-1)},isValidAddress:function(t,e){return this.isValidRow(e)&&this.isValidColumn(t)},getWidth:function(){return Q.Matrix.getWidth(this)},getHeight:function(){return Q.Matrix.getHeight(this)},read:function(t,e){return this.isValidAddress(t,e)?this.rows[e][t]:Q.error(`Q.Matrix could not read from cell address (x=${t}, y=${e}) in matrix#${this.index}.`,this)},clone:function(){return new Q.Matrix(...this.rows)},isEqualTo:function(t){return Q.Matrix.areEqual(this,t)},toArray:function(){return this.rows},toXsv:function(t,e){return Q.Matrix.toXsv(this,t,e)},toCsv:function(){return Q.Matrix.toXsv(this,"\n",",")},toTsv:function(){return Q.Matrix.toXsv(this,"\n","\t")},toHtml:function(){return this.rows.reduce(function(t,e){return t+e.reduce(function(t,e){return t+"\n\t\t<td>"+e.toText()+"</td>"},"\n\t<tr>")+"\n\t</tr>"},"\n<table>")+"\n</table>"},write$:function(t,e,i){return this.isValidAddress(t,e)?(Q.ComplexNumber.isNumberLike(i)&&(i=new Q.ComplexNumber(i)),i instanceof Q.ComplexNumber!=!0?Q.error(`Attempted to write an invalid value (${i}) to matrix#${this.index} at x=${t}, y=${e}`,this):(this.rows[e][t]=i,this)):Q.error(`Invalid cell address for Matrix#${this.index}: x=${t}, y=${e}`,this)},copy$:function(t){if(!0!==Q.Matrix.isMatrixLike(t))return Q.error(`Q.Matrix attempted to copy something that was not a matrix in to this matrix#${t.index}.`,this);if(!0!==Q.Matrix.haveEqualDimensions(t,this))return Q.error(`Q.Matrix cannot copy matrix#${t.index} of dimensions ${t.columns.length}x${t.rows.length} in to this matrix#${this.index} of dimensions ${this.columns.length}x${this.rows.length} because their dimensions do not match.`,this);const e=this;return t.rows.forEach(function(t,i){t.forEach(function(t,n){e.rows[i][n]=t})}),this},fromArray$:function(t){return this.copy$(Q.Matrix.fromArray(t))},fromCsv$:function(t){return this.copy$(Q.Matrix.fromCsv(t))},fromTsv$:function(t){return this.copy$(Q.Matrix.fromTsv(t))},fromHtml$:function(t){return this.copy$(Q.Matrix.fromHtml(t))},add:function(t){return Q.Matrix.add(this,t)},multiplyScalar:function(t){return Q.Matrix.multiplyScalar(this,t)},multiply:function(t){return Q.Matrix.multiply(this,t)},multiplyTensor:function(t){return Q.Matrix.multiplyTensor(this,t)},add$:function(t){return this.copy$(this.add(t))},multiplyScalar$:function(t){return this.copy$(this.multiplyScalar(t))}}),Q.Matrix.createConstants("IDENTITY_2X2",Q.Matrix.createIdentity(2),"IDENTITY_3X3",Q.Matrix.createIdentity(3),"IDENTITY_4X4",Q.Matrix.createIdentity(4),"CONSTANT0_2X2",new Q.Matrix([1,1],[0,0]),"CONSTANT1_2X2",new Q.Matrix([0,0],[1,1]),"NEGATION_2X2",new Q.Matrix([0,1],[1,0]),"TEST_MAP_9X9",new Q.Matrix([11,21,31,41,51,61,71,81,91],[12,22,32,42,52,62,72,82,92],[13,23,33,43,53,63,73,83,93],[14,24,34,44,54,64,74,84,94],[15,25,35,45,55,65,75,85,95],[16,26,36,46,56,66,76,86,96],[17,27,37,47,57,67,77,87,97],[18,28,38,48,58,68,78,88,98],[19,29,39,49,59,69,79,89,99]))},function(t,e){Q.Qubit=function(t,e,i,n){if(Q.Matrix.isMatrixLike(t)&&void 0===e?(e=t.rows[1][0],t=t.rows[0][0]):("number"==typeof t&&(t=new Q.ComplexNumber(t,0)),"number"==typeof e&&(e=new Q.ComplexNumber(e,0)),t instanceof Q.ComplexNumber!=!0&&(t=new Q.ComplexNumber(1,0)),e instanceof Q.ComplexNumber!=!0&&(e=Q.ComplexNumber.ONE.subtract(Math.pow(t.absolute(),2)).squareRoot())),Math.pow(t.absolute(),2)+Math.pow(e.absolute(),2)-1>Q.EPSILON)return Q.error(`Q.Qubit could not accept the initialization values of a=${t} and b=${e} because their squares do not add up to 1.`);if(Q.Matrix.call(this,[t],[e]),this.index=Q.Qubit.index++,Object.defineProperty(this,"alpha",{get:function(){return this.rows[0][0]},set:function(t){this.rows[0][0]=t}}),Object.defineProperty(this,"beta",{get:function(){return this.rows[1][0]},set:function(t){this.rows[1][0]=t}}),"string"==typeof i&&(this.label=i),"string"==typeof n&&(this.name=n),void 0===this.label||void 0===this.name){const i=Object.values(Q.Qubit.constants).find(function(i){return t.isEqualTo(i.alpha)&&e.isEqualTo(i.beta)});void 0===i?(this.label="?",this.name="Unnamed"):(void 0===this.label&&(this.label=i.label),void 0===this.name&&(this.name=i.name))}},Q.Qubit.prototype=Object.create(Q.Matrix.prototype),Q.Qubit.prototype.constructor=Q.Qubit,Object.assign(Q.Qubit,{index:0,help:function(){return Q.help(this)},constants:{},createConstant:Q.createConstant,createConstants:Q.createConstants,findBy:function(t,e){return Object.values(Q.Qubit.constants).find(function(i){return"string"==typeof e&&"string"==typeof i[t]?e.toLowerCase()===i[t].toLowerCase():e===i[t]})},findBySymbol:function(t){return Q.Qubit.findBy("symbol",t)},findByName:function(t){return Q.Qubit.findBy("name",t)},findByBeta:function(t){return t instanceof Q.ComplexNumber==!1&&(t=new Q.ComplexNumber(t)),Object.values(Q.Qubit.constants).find(function(e){return e.beta.isEqualTo(t)})},areEqual:function(t,e){return t.alpha.isEqualTo(e.alpha)&&t.beta.isEqualTo(e.beta)},collapse:function(t){const e=Math.pow(t.alpha.absolute(),2),i=(Math.pow(t.beta.absolute(),2),Math.pow(2,32)-1),n=new Uint32Array(1);return window.crypto.getRandomValues(n),n/i<=e?new Q.Qubit(1,0):new Q.Qubit(0,1)},applyGate:function(t,e,...i){return e instanceof Q.Gate==!1?Q.error(`Q.Qubit attempted to apply something that was not a gate to this qubit #${t.index}.`):e.applyToQubit(t,...i)},toText:function(t){return t.alpha.toText()+"\n"+t.beta.toText()},toStateVectorText:function(t){return`|${t.beta.toText()}⟩`},toStateVectorHtml:function(t){return`<span class="Q-state-vector ket">${t.beta.toText()}</span>`},toBlochSphere:function(t){const e=Q.ComplexNumber.arcCosine(t.alpha).multiply(2);isNaN(e.real)&&(e.real=0),isNaN(e.imaginary)&&(e.imaginary=0);const i=Q.ComplexNumber.log(t.beta.divide(Q.ComplexNumber.sine(e.divide(2)))).divide(Q.ComplexNumber.I);isNaN(i.real)&&(i.real=0),isNaN(i.imaginary)&&(i.imaginary=0);const n={x:Q.ComplexNumber.sine(e).multiply(Q.ComplexNumber.cosine(i)).real,y:Q.ComplexNumber.sine(e).multiply(Q.ComplexNumber.sine(i)).real,z:Q.ComplexNumber.cosine(e).real},r={x:n.y,y:n.z,z:n.x};return{theta:e.real,phi:i.real,vector:n,position:r}},fromBlochVector:function(t,e,i){}}),Q.Qubit.createConstants("HORIZONTAL",new Q.Qubit(1,0,"H","Horizontal"),"VERTICAL",new Q.Qubit(0,1,"V","Vertical"),"DIAGONAL",new Q.Qubit(Math.SQRT1_2,Math.SQRT1_2,"D","Diagonal"),"ANTI_DIAGONAL",new Q.Qubit(Math.SQRT1_2,-Math.SQRT1_2,"A","Anti-diagonal"),"RIGHT_HAND_CIRCULAR_POLARIZED",new Q.Qubit(Math.SQRT1_2,new Q.ComplexNumber(0,-Math.SQRT1_2),"R","Right-hand Circular Polarized"),"LEFT_HAND_CIRCULAR_POLARIZED",new Q.Qubit(Math.SQRT1_2,new Q.ComplexNumber(0,Math.SQRT1_2),"L","Left-hand Circular Polarized")),Object.assign(Q.Qubit.prototype,{copy$:function(t){if(!0!==Q.Matrix.isMatrixLike(t))return Q.error(`Q.Qubit attempted to copy something that was not a matrix in this qubit #${qubit.index}.`,this);if(!0!==Q.Matrix.haveEqualDimensions(t,this))return Q.error(`Q.Qubit cannot copy matrix#${t.index} of dimensions ${t.columns.length}x${t.rows.length} in to this qubit #${this.index} of dimensions ${this.columns.length}x${this.rows.length} because their dimensions do not match.`,this);const e=this;return t.rows.forEach(function(t,i){t.forEach(function(t,n){e.rows[i][n]=t})}),this.dirac=t.dirac,this},clone:function(){return new Q.Qubit(this.alpha,this.beta)},isEqualTo:function(t){return Q.Qubit.areEqual(this,t)},collapse:function(){return Q.Qubit.collapse(this)},applyGate:function(t,...e){return Q.Qubit.applyGate(this,t,...e)},toText:function(){return Q.Qubit.toText(this)},toStateVectorText:function(){return Q.Qubit.toStateVectorText(this)},toStateVectorHtml:function(){return Q.Qubit.toStateVectorHtml(this)},toBlochSphere:function(){return Q.Qubit.toBlochSphere(this)},collapse$:function(){return this.copy$(Q.Qubit.collapse(this))},applyGate$:function(t){return this.copy$(Q.Qubit.applyGate(this,t))}})},function(t,e){Q.Gate=function(t){Object.assign(this,t),this.index=Q.Gate.index++,"string"!=typeof this.symbol&&(this.symbol="?"),"string"!=typeof this.symbolAmazonBraket&&(this.symbolAmazonBraket=this.symbol.toLowerCase());const e=this,i=Object.values(Q.Gate.constants).find(function(t){return t.symbol===e.symbol});i&&Q.warn(`Q.Gate is creating a new instance, #${this.index}, that uses the same symbol as a pre-existing Gate constant:`,i),"string"!=typeof this.name&&(this.name="Unknown"),"string"!=typeof this.nameCss&&(this.nameCss="unknown"),"function"==typeof this.updateMatrix$&&this.updateMatrix$(),"function"!=typeof this.applyToQubit&&(this.matrix instanceof Q.Matrix==!0?this.applyToQubit=function(t){return new Q.Qubit(this.matrix.multiply(t))}:this.applyToQubit=function(t){return t})},Object.assign(Q.Gate,{index:0,constants:{},createConstant:Q.createConstant,createConstants:Q.createConstants,findBy:function(t,e){return Object.values(Q.Gate.constants).find(function(i){return"string"==typeof e&&"string"==typeof i[t]?e.toLowerCase()===i[t].toLowerCase():e===i[t]})},findBySymbol:function(t){return Q.Gate.findBy("symbol",t)},findByName:function(t){return Q.Gate.findBy("name",t)}}),Object.assign(Q.Gate.prototype,{clone:function(t){return new Q.Gate(Object.assign({},this,t))},applyToQubits:function(){return Array.from(arguments).map(this.applyToQubit.bind(this))},set$:function(t,e){return this[t]=e,this},setSymbol$:function(t){return this.set$("symbol",t)}}),Q.Gate.createConstants("IDENTITY",new Q.Gate({symbol:"I",symbolAmazonBraket:"i",symbolSvg:"",name:"Identity",nameCss:"identity",matrix:Q.Matrix.IDENTITY_2X2}),"CURSOR",new Q.Gate({symbol:"*",symbolAmazonBraket:"i",symbolSvg:"",name:"Identity",nameCss:"identity",matrix:Q.Matrix.IDENTITY_2X2}),"MEASURE",new Q.Gate({symbol:"M",symbolAmazonBraket:"m",symbolSvg:"",name:"Measure",nameCss:"measure",matrix:Q.Matrix.IDENTITY_2X2,applyToQubit:function(t){}}),"HADAMARD",new Q.Gate({symbol:"H",symbolAmazonBraket:"h",symbolSvg:"",name:"Hadamard",nameCss:"hadamard",matrix:new Q.Matrix([Math.SQRT1_2,Math.SQRT1_2],[Math.SQRT1_2,-Math.SQRT1_2])}),"PAULI_X",new Q.Gate({symbol:"X",symbolAmazonBraket:"x",symbolSvg:"",name:"Pauli X",nameCss:"pauli-x",matrix:new Q.Matrix([0,1],[1,0])}),"PAULI_Y",new Q.Gate({symbol:"Y",symbolAmazonBraket:"y",symbolSvg:"",name:"Pauli Y",nameCss:"pauli-y",matrix:new Q.Matrix([0,new Q.ComplexNumber(0,-1)],[new Q.ComplexNumber(0,1),0])}),"PAULI_Z",new Q.Gate({symbol:"Z",symbolAmazonBraket:"z",symbolSvg:"",name:"Pauli Z",nameCss:"pauli-z",matrix:new Q.Matrix([1,0],[0,-1])}),"PHASE",new Q.Gate({symbol:"P",symbolAmazonBraket:"p",symbolSvg:"",name:"Phase",nameCss:"phase",phi:1,updateMatrix$:function(t){return!0===Q.isUsefulNumber(t)&&(this.phi=t),this.matrix=new Q.Matrix([1,0],[0,Q.ComplexNumber.E.power(new Q.ComplexNumber(0,this.phi))]),this},applyToQubit:function(t,e){!0!==Q.isUsefulNumber(e)&&(e=this.phi);const i=new Q.Matrix([1,0],[0,Q.ComplexNumber.E.power(new Q.ComplexNumber(0,e))]);return new Q.Qubit(i.multiply(t))}}),"PI_8",new Q.Gate({symbol:"T",symbolAmazonBraket:"t",symbolSvg:"",name:"π ÷ 8",nameCss:"pi8",matrix:new Q.Matrix([1,0],[0,Q.ComplexNumber.E.power(new Q.ComplexNumber(0,Math.PI/4))])}),"BLOCH",new Q.Gate({symbol:"B",symbolSvg:"",name:"Bloch sphere",nameCss:"bloch",applyToQubit:function(t){}}),"SWAP",new Q.Gate({symbol:"S",symbolAmazonBraket:"s",symbolSvg:"",name:"Swap",nameCss:"swap",matrix:new Q.Matrix([1,0,0,0],[0,0,1,0],[0,1,0,0],[0,0,0,1])}),"SWAP1_2",new Q.Gate({symbol:"√S",symbolSvg:"",name:"√Swap",nameCss:"swap1-2",matrix:new Q.Matrix([1,0,0,0],[0,new Q.ComplexNumber(.5,.5),new Q.ComplexNumber(.5,-.5),0],[0,new Q.ComplexNumber(.5,-.5),new Q.ComplexNumber(.5,.5),0],[0,0,0,1])}))},function(t,e){Q.History=function(t){this.instance=t,this.entries=[[{redo:{},undo:[{}]}]],this.index=0,this.isRecording=!0},Object.assign(Q.History.prototype,{assess:function(){const t=this.instance;return this.index>0?window.dispatchEvent(new CustomEvent("Q.History undo is capable",{detail:{instance:t}})):window.dispatchEvent(new CustomEvent("Q.History undo is depleted",{detail:{instance:t}})),this.index+1<this.entries.length?window.dispatchEvent(new CustomEvent("Q.History redo is capable",{detail:{instance:t}})):window.dispatchEvent(new CustomEvent("Q.History redo is depleted",{detail:{instance:t}})),this},createEntry$:function(){this.entries.splice(this.index+1),this.entries.push([]),this.index=this.entries.length-1},record$:function(t){return this.isRecording&&(this.entries[this.index].push(t),this.index=this.entries.length-1,this.assess()),this},step$:function(t){if(t<0&&this.index<1||t>0&&this.index>this.entries.length-2)return!1;this.isRecording=!1;const e=this.instance,i=t<0?"undo":"redo";return t>0&&this.index++,(t>0?Array.from(this.entries[this.index]):Array.from(this.entries[this.index]).reverse()).reduce(function(t,e,n){return t.concat(e[i])},[]).forEach(function(t,i){"function"==typeof t.func&&t.func.apply(e,t.args)}),t<0&&this.index--,this.isRecording=!0,this.assess(),!0},undo$:function(){return this.step$(-1)},redo$:function(){return this.step$(1)},report:function(){const t=function(t,e,i){return i>0&&(t+=",  "),t+("object"==typeof e&&e.name?e.name:e)};return this.entries.reduce(function(e,i,n){return e+="\n\n"+n+" ════════════════════════════════════════"+i.reduce(function(e,i,n){return e+="\n\n    "+n+" ────────────────────────────────────────\n",i.redo&&(e+="\n        ⟳ Redo   ── "+i.redo.name+"  ",i.redo.args&&(e+=i.redo.args.reduce(t,""))),e+=i.undo.reduce(function(e,i,n){return e+="\n        ⟲ Undo "+n+" ── "+i.name+"  ",i.args&&(e+=i.args.reduce(t,"")),e},"")},"")},"History entry cursor: "+this.index)}})},function(t,e){Q.Circuit=function(t,e){this.index=Q.Circuit.index++,Q.isUsefulInteger(t)||(t=3),this.bandwidth=t,Q.isUsefulInteger(e)||(e=5),this.timewidth=e,this.qubits=new Array(t).fill(Q.Qubit.HORIZONTAL),this.operations=[],this.needsEvaluation=!0,this.results=[],this.matrix=null,this.history=new Q.History(this)},Object.assign(Q.Circuit,{index:0,help:function(){return Q.help(this)},constants:{},createConstant:Q.createConstant,createConstants:Q.createConstants,fromText:function(t){return void 0===t?new Q.Circuit:(void 0!==t.raw&&(t=""+t.raw),Q.Circuit.fromTableTransposed(t.trim().split(/\r?\n/).filter(function(t){return t.length}).map(function(t,e){return t.trim().split(/[-+\s+=+]/).filter(function(t){return t.length}).map(function(t,e){const i=t.match(/(^\w+)(\.(\w+))*(#(\d+))*/);return{gateSymbol:i[1],operationMomentId:i[3],mappingIndex:+i[5]}})})))},fromText2:function(t){if(void 0===(t="\n\t\t\tH  C  C\n\t\t\tI  C1 C1\n\t\t\tI  X1 S1\n\t\t\tI  X1 S1"))return new Q.Circuit;void 0!==t.raw&&(t=""+t.raw),t.trim().split(/\r?\n/).filter(function(t){return t.length}).map(function(t,e){return t.trim().split(/[-+\s+=+]/).filter(function(t){return t.length}).map(function(t,e){t.match(/(^\w+)(\.(\w+))*(#(\d+))*/)})})},fromTableTransposed:function(t){const e=t.length,i=t.reduce(function(t,e){return Math.max(t,e.length)},0),n=new Q.Circuit(e,i);n.bandwidth=e,n.timewidth=i;for(let r=0;r<e;r++){const e=r+1;for(let o=0;o<i;o++){const i=o+1,a=t[r][o];let s=!1;for(let u=0;u<r;u++){const r=t[u][o];if(a.gateSymbol===r.gateSymbol&&a.operationMomentId===r.operationMomentId&&Q.isUsefulInteger(a.mappingIndex)&&Q.isUsefulInteger(r.mappingIndex)&&a.mappingIndex!==r.mappingIndex){const t=n.operations.findIndex(function(t){return t.momentIndex===i&&t.registerIndices.includes(u+1)});n.operations[t].registerIndices[a.mappingIndex]=e,n.operations[t].isControlled="*"!=a.gateSymbol,s=!0}}if(!1===s&&"I"!==a.gateSymbol){const t=Q.Gate.findBySymbol(a.gateSymbol),r=[];Q.isUsefulInteger(a.mappingIndex)?r[a.mappingIndex]=e:r[0]=e,n.operations.push({gate:t,momentIndex:i,registerIndices:r,isControlled:!1,operationMomentId:a.operationMomentId})}}}return n.sort$(),n},controlled:function(t){const e=t.getWidth(),i=Q.Matrix.createIdentity(2*e);for(let n=0;n<e;n++)for(let r=0;r<e;r++){const o=t.read(n,r);i.write$(n+e,r+e,o)}return i},expandMatrix:function(t,e,i){const n=[],r=Math.pow(2,t);for(let e=0;e<i.length;e++)i[e]=t-0-i[e];i.reverse();for(let e=0;e<t;e++)-1==i.indexOf(e)&&n.push(e);const o=new Q.Matrix.createZero(r);let a=r;for(;a--;){let t=r;for(;t--;){let r=!0,s=n.length;for(;s--;)if((a&1<<n[s])!=(t&1<<n[s])){r=!1;break}if(r){let n=0,r=0,s=i.length;for(;s--;){const e=i[s];n|=(a&1<<e)>>e<<s,r|=(t&1<<e)>>e<<s}o.write$(a,t,e.read(n,r))}}}return o},evaluate:function(t){window.dispatchEvent(new CustomEvent("Q.Circuit.evaluate began",{detail:{circuit:t}})),t.sort$();const e=new Q.Matrix(1,Math.pow(2,t.bandwidth));e.write$(0,0,1);const i=t.operations.length;let n=0,r=t.operations.reduce(function(e,r,o){let a;r.registerIndices.length<1/0&&(r.isControlled,a=r.gate.matrix);for(let t=0;t<r.registerIndices.length-1;t++)a=Q.Circuit.controlled(a);const s=r.registerIndices.slice();e=Q.Circuit.expandMatrix(t.bandwidth,a,s).multiply(e);const u=++n/i;return window.dispatchEvent(new CustomEvent("Q.Circuit.evaluate progressed",{detail:{circuit:t,progress:u,operationsCompleted:n,operationsTotal:i,momentIndex:r.momentIndex,registerIndices:r.registerIndices,gate:r.gate.name,state:e}})),e},e);const o=r.rows.reduce(function(e,i,n){return e.push({state:"|"+parseInt(n,10).toString(2).padStart(t.bandwidth,"0")+"⟩",probability:Math.pow(i[0].absolute(),2)}),e},[]);return t.needsEvaluation=!1,t.matrix=r,t.results=o,window.dispatchEvent(new CustomEvent("Q.Circuit.evaluate completed",{detail:{circuit:t,results:o}})),r}}),Object.assign(Q.Circuit.prototype,{clone:function(){const t=this.copy();return t.qubits=this.qubits.slice(),t.results=this.results.slice(),t.needsEvaluation=this.needsEvaluation,t},evaluate$:function(){return Q.Circuit.evaluate(this),this},report$:function(t){this.needsEvaluation&&this.evaluate$(),Q.isUsefulInteger(t)||(t=20);const e=this;return this.results.reduce(function(i,n,r){const o=Math.round(n.probability*t),a=t-o;return i+"\n"+(r+1).toString().padStart(Math.ceil(Math.log10(Math.pow(2,e.qubits.length)))," ")+"  "+n.state+"  "+"".padStart(o,"█")+"".padStart(a,"░")+Q.round(Math.round(100*n.probability),8).toString().padStart(4," ")+"% chance"},"")+"\n"},try$:function(){this.needsEvaluation&&this.evaluate$();const t=new Array(this.results.length);this.results.reduce(function(e,i,n){return e+=i.probability,t[n]=e,e},0);const e=Math.random();return t.findIndex(function(t){return e<=t})},sort$:function(){return this.operations.sort(function(t,e){return t.momentIndex===e.momentIndex?Math.min(...t.registerIndices)-Math.min(e.registerIndices):t.momentIndex-e.momentIndex}),this},toTable:function(){const t=new Array(this.timewidth),e=this;t.timewidth=this.timewidth,t.bandwidth=this.bandwidth,t.fill(0).forEach(function(t,i,n){const r=new Array(e.bandwidth);r.fill(0).forEach(function(t,e,i){i[e]={symbol:"I",symbolDisplay:"I",name:"Identity",nameCss:"identity",gateInputIndex:0,bandwidth:0,thisGateAmongMultiQubitGatesIndex:0,aSiblingIsAbove:!1,aSiblingIsBelow:!1}}),n[i]=r});let i=1,n=0,r={};return this.operations.forEach(function(e,o,a){i!==e.momentIndex&&(t[i].gateTypesUsedThisMoment=r,i=e.momentIndex,n=0,r={}),e.registerIndices.length>1&&(t[i-1].multiRegisterOperationIndex=n,n++),void 0===r[e.gate.symbol]?r[e.gate.symbol]=1:r[e.gate.symbol]++;let s=e.gate.name.toLowerCase().replace(/\s+/g,"-");e.registerIndices.forEach(function(i,a){let u=!1;e.registerIndices.length>1&&(u=!0,s=a===e.registerIndices.length-1?"target":"control"),t[e.momentIndex-1][i-1]={symbol:e.gate.symbol,symbolDisplay:e.gate.symbol,name:e.gate.name,nameCss:s,operationIndex:o,momentIndex:e.momentIndex,registerIndex:i,isMultiRegisterOperation:u,multiRegisterOperationIndex:n,gatesOfThisTypeNow:r[e.gate.symbol],indexAmongSiblings:a,siblingExistsAbove:Math.min(...e.registerIndices)<i,siblingExistsBelow:Math.max(...e.registerIndices)>i}}),t[i-1].gateTypesUsedThisMoment=r}),t.forEach(function(t,e){t.forEach(function(e,i){e.isMultiRegisterOperation&&(t.gateTypesUsedThisMoment[e.symbol]>1&&(e.symbolDisplay=e.symbol+"."+(e.gatesOfThisTypeNow-1)),e.symbolDisplay+="#"+e.indexAmongSiblings)})}),t.forEach(function(t){const e=t.reduce(function(t,e){return Math.max(t,e.symbolDisplay.length)},1);t.maximumCharacterWidth=e}),t.maximumCharacterWidth=t.reduce(function(t,e){return Math.max(t,e.maximumCharacterWidth)},1),t},toText:function(t){const e=this.toTable(),i=new Array(e.bandwidth).fill("");for(let n=0;n<e.timewidth;n++)for(let r=0;r<e.bandwidth;r++){let o=e[n][r].symbolDisplay.padEnd(e[n].maximumCharacterWidth,"-");t&&n<e.timewidth-1&&(o=e[n][r].symbolDisplay.padEnd(e.maximumCharacterWidth,"-")),n>0&&(o="-"+o),i[r]+=o}return"\n"+i.join("\n")},toDiagram:function(t){const e=this.toTable(),i=new Array(3*e.bandwidth+1).fill("");i[0]="        ",this.qubits.forEach(function(t,e){const n=3*e;i[n+1]+="        ",i[n+2]+="r"+(e+1)+"  |"+t.beta.toText().trim()+"⟩─",i[n+3]+="        "});for(let n=0;n<e.timewidth;n++){const r=t?e.maximumCharacterWidth:e[n].maximumCharacterWidth;i[0]+=Q.centerText("m"+(n+1),r+4);for(let t=0;t<e.bandwidth;t++){let o=e[n][t],a="",s="",u="";if("I"===o.symbol)a+="  ",s+="──",u+="  ",a+=" ".padEnd(r),s+=Q.centerText("○",r,"─"),u+=" ".padEnd(r),a+="  ",n<e.timewidth-1?s+="──":s+="  ",u+="  ";else if(o.isMultiRegisterOperation?(a+="╭─",u+="╰─"):(a+="┌─",u+="└─"),s+="┤ ",a+="─".padEnd(r,"─"),s+=Q.centerText(o.symbolDisplay,r),u+="─".padEnd(r,"─"),o.isMultiRegisterOperation?(a+="─╮",u+="─╯"):(a+="─┐",u+="─┘"),s+=n<e.timewidth-1?" ├":" │",o.isMultiRegisterOperation){let t=2*o.multiRegisterOperationIndex%(e[n].maximumCharacterWidth+1)+1;o.siblingExistsAbove&&(a=a.substring(0,t)+"┴"+a.substring(t+1)),o.siblingExistsBelow&&(u=u.substring(0,t)+"┬"+u.substring(t+1))}const c=3*t;i[c+1]+=a,i[c+2]+=s,i[c+3]+=u}}return"\n"+i.join("\n")},toShader:function(){},toAmazonBraket:function(){return"from braket.circuits import Circuit\nfrom braket.aws import AwsQuantumSimulator\n\ndevice_arn = “arn:aws:aqx:::quantum-simulator:aqx:qs1”\ndevice = AwsQuantumSimulator(device_arn)\ns3_folder = (“my_bucket”, “my_prefix”)\n\n"+this.operations.reduce(function(t,e){let i=void 0!==e.gate.AmazonBraketName?e.gate.AmazonBraketName:e.gate.symbol.substr(0,1).toLowerCase();return"X"===e.gate.symbol&&e.registerIndices.length>1&&(i="cnot"),t+"."+i+"("+e.registerIndices.reduce(function(t,e,i){return t+(i>0?",":"")+(e-1)},"")+")"},"qjs_circuit = Circuit()")+"\n\nprint(device.run(qjs_circuit, s3_folder).result().measurement_counts())"},toLatex:function(){return"\\Qcircuit @C=1.0em @R=0.7em {\n"+this.toTable().reduce(function(t,e,i){e.forEach(function(t,e,i){let n="qw";"I"!==t.symbol&&(t.isMultiRegisterOperation?0===t.indexAmongSiblings?n="X"===t.symbol?"targ":t.symbol.toLowerCase():t.indexAmongSiblings>0&&(n="ctrl{?}"):n=t.symbol.toLowerCase()),i[e].latexCommand=n});const n=e.reduce(function(t,e){return Math.max(t,e.latexCommand.length)},0);return e.forEach(function(e,i){t[i]+="& \\"+e.latexCommand.padEnd(n)+"  "}),t},new Array(this.bandwidth).fill("\n\t")).join("\\\\")+"\n}"},get:function(t,e){return this.operations.find(function(i){return i.momentIndex===t&&i.registerIndices.includes(e)})},clear$:function(t,e){const i=this;if(2!==arguments.length&&Q.warn(`Q.Circuit.clear$ expected 2 arguments but received ${arguments.length}.`),!0!==Q.isUsefulInteger(t))return Q.error(`Q.Circuit attempted to clear an input on Circuit #${i.index} using an invalid moment index:`,t);if(Q.isUsefulInteger(e)&&(e=[e]),e instanceof Array!=!0)return Q.error(`Q.Circuit attempted to clear an input on Circuit #${i.index} using an invalid register indices array:`,e);const n=i.operations.reduce(function(i,n,r){return n.momentIndex===t&&n.registerIndices.some(function(t){return e.includes(t)})&&i.push({index:r,momentIndex:n.momentIndex,registerIndices:n.registerIndices,gate:n.gate}),i},[]);return n.reduce(function(t,e){return i.operations.splice(e.index-t,1),t+1},0),this.sort$(),n.length&&(this.history.record$({redo:{name:"clear$",func:i.clear$,args:Array.from(arguments)},undo:n.reduce(function(t,e){return t.push({name:"set$",func:i.set$,args:[e.gate,e.momentIndex,e.registerIndices]}),t},[])}),n.forEach(function(e){window.dispatchEvent(new CustomEvent("Q.Circuit.clear$",{detail:{circuit:i,momentIndex:t,registerIndices:e.registerIndices}}))})),i},setProperty$:function(t,e){return this[t]=e,this},setName$:function(t){return"function"==typeof t&&(t=t()),this.setProperty$("name",t)},set$:function(t,e,i){const n=this;if("string"==typeof t&&(t=Q.Gate.findBySymbol(t)),t instanceof Q.Gate!=!0)return Q.error(`Q.Circuit attempted to add a gate to circuit #${this.index} at moment #${e} that is not a gate:`,t);if(!0!==Q.isUsefulNumber(e)||!0!==Number.isInteger(e)||e<1||e>this.timewidth)return Q.error(`Q.Circuit attempted to add a gate to circuit #${this.index} at a moment index that is not valid:`,e);if("number"==typeof i&&(i=[i]),i instanceof Array!=!0)return Q.error(`Q.Circuit attempted to add a gate to circuit #${this.index} at moment #${e} with an invalid register indices array:`,i);if(0===i.length)return Q.error(`Q.Circuit attempted to add a gate to circuit #${this.index} at moment #${e} with an empty register indices array:`,i);if(i.reduce(function(t,e){return t&&e>0&&e<=n.bandwidth},!1))return Q.warn(`Q.Circuit attempted to add a gate to circuit #${this.index} at moment #${e} with some out of range qubit indices:`,i);const r=!!n.operations.find(function(n){return e===n.momentIndex&&t===n.gate&&i.length===n.registerIndices.length&&i.every(t=>n.registerIndices.includes(t))});if(!0!==r){this.clear$(e,i);const r=i.length>1&&t!==Q.Gate.SWAP,o={gate:t,momentIndex:e,registerIndices:i,isControlled:r};this.operations.push(o),this.sort$(),this.history.record$({redo:{name:"set$",func:n.set$,args:Array.from(arguments)},undo:[{name:"clear$",func:n.clear$,args:[e,i]}]}),window.dispatchEvent(new CustomEvent("Q.Circuit.set$",{detail:{circuit:n,operation:o}}))}return n},determineRanges:function(t){void 0===t&&(t={});let{qubitFirstIndex:e,qubitRange:i,qubitLastIndex:n,momentFirstIndex:r,momentRange:o,momentLastIndex:a}=t;if("number"!=typeof e&&(e=0),"number"!=typeof n&&"number"!=typeof i&&(n=this.bandwidth),"number"!=typeof n&&"number"==typeof i)n=e+i;else{if("number"!=typeof n||"number"==typeof i)return Q.error("Q.Circuit attempted to copy a circuit but could not understand what qubits to copy.");i=n-e}if("number"!=typeof r&&(r=0),"number"!=typeof a&&"number"!=typeof o&&(a=this.timewidth),"number"!=typeof a&&"number"==typeof o)a=r+o;else{if("number"!=typeof a||"number"==typeof o)return Q.error("Q.Circuit attempted to copy a circuit but could not understand what moments to copy.");o=a-r}return Q.log(.8,"\nQ.Circuit copy operation:","\n\n  qubitFirstIndex",e,"\n  qubitLastIndex ",n,"\n  qubitRange     ",i,"\n\n  momentFirstIndex",r,"\n  momentLastIndex ",a,"\n  momentRange     ",o,"\n\n"),{qubitFirstIndex:e,qubitRange:i,qubitLastIndex:n,momentFirstIndex:r,momentRange:o,momentLastIndex:a}},copy:function(t,e){let{registerFirstIndex:i,registerRange:n,registerLastIndex:r,momentFirstIndex:o,momentRange:a,momentLastIndex:s}=this.determineRanges(t);const u=new Q.Circuit(n,a);return this.operations.filter(function(t){return t.registerIndices.every(function(e){return t.momentIndex>=o&&t.momentIndex<s&&t.registerIndex>=i&&t.registerIndex<r})}).forEach(function(t){const e=t.registerIndices.map(function(t){return t-i});u.set$(t.gate,1+m-o,e)}),u},cut$:function(t){return this.copy(t,!0)},spliceCut$:function(t){let{qubitFirstIndex:e,qubitRange:i,qubitLastIndex:n,momentFirstIndex:r,momentRange:o,momentLastIndex:a}=this.determineRanges(t);return i!==this.bandwidth&&o!==this.timewidth?Q.error(`Q.Circuit attempted to splice circuit #${this.index} by an area that did not include all qubits _or_ all moments.`):(i===this.bandwidth&&(this.moments=this.moments.reduce(function(t,e,i){return(i<r-1||i>=a-1)&&t.push(e),t},[]),this.timewidth-=o),o===this.timewidth&&(this.inputs.splice(e,i),this.moments=this.moments.map(function(t){return t.reduce(function(t,i){return i.qubitIndices.every(function(t){return t<e||t>=n})&&t.push(i),t},[]).map(function(t){return t.qubitIndices=t.qubitIndices.map(function(t){return t>=n?t-i:t}),t})}),this.bandwidth-=i),this.removeHangingOperations$(),this.fillEmptyOperations$(),this)},splicePaste$:function(){},paste$:function(t,e=0,i=0,n=!0){const r=this;return this.timewidth=Math.max(this.timewidth,e+t.timewidth),this.bandwidth=Math.max(this.bandwidth,i+t.bandwidth),this.ensureMomentsAreReady$(),this.fillEmptyOperations$(),t.moments.forEach(function(t,n){t.forEach(function(t){r.set$(t.gate,n+e+1,t.qubitIndices.map(function(t){return t+i}))})}),n&&this.removeHangingOperations$(),this.fillEmptyOperations$(),this},pasteInsert$:function(t,e,i){return shouldClean&&this.removeHangingOperations$(),this.fillEmptyOperations$(),this},expand$:function(){return this.fillEmptyOperations$(),thiis},trim$:function(t){let{qubitFirstIndex:e,qubitRange:i,qubitLastIndex:n,momentFirstIndex:r,momentRange:o,momentLastIndex:a}=this.determineRanges(t);return this.moments=this.moments.slice(r,a),this.timewidth=o,this.inputs=this.inputs.slice(e,n),this.bandwidth=i,this.removeHangingOperations$(),this.fillEmptyOperations$(),this}}),Object.entries(Q.Gate.constants).forEach(function(t){const e=t[0],i=t[1],n=function(t,e){return this.set$(i,t,e),this};Q.Circuit.prototype[e]=n,Q.Circuit.prototype[i.symbol]=n,Q.Circuit.prototype[i.symbol.toLowerCase()]=n}),Q.Circuit.createConstants("BELL",Q`

		H  X#0
		I  X#1
	`)},function(t,e){Q.Circuit.Editor=function(t,e){t instanceof Q.Circuit!=!0&&(t=new Q.Circuit),this.circuit=t,this.index=Q.Circuit.Editor.index++;const i=function(){return document.createElement("div")};this.name="string"==typeof t.name?t.name:"Q Editor "+this.index,"string"==typeof e&&(e=document.getElementById(e));const n=e instanceof HTMLElement?e:i();if(n.classList.add("Q-circuit"),"string"==typeof n.getAttribute("id"))this.domId=n.getAttribute("id");else{let t=this.name.replace(/^[^a-z]+|[^\w:.-]+/gi,"-"),e=t,i=1;for(;null!==document.getElementById(e);)e=t+"-"+ ++i;this.domId=e,n.setAttribute("id",this.domId)}n.circuit=t,this.domElement=n;const r=i();n.appendChild(r),r.classList.add("Q-circuit-toolbar");const o=i();r.appendChild(o),o.classList.add("Q-circuit-button","Q-circuit-toggle","Q-circuit-toggle-lock"),o.setAttribute("title","Lock / unlock"),o.innerText="🔓";const a=i();r.appendChild(a),a.classList.add("Q-circuit-button","Q-circuit-button-undo"),a.setAttribute("title","Undo"),a.setAttribute("Q-disabled","Q-disabled"),a.innerHTML="⟲",window.addEventListener("Q.History undo is depleted",function(e){e.detail.instance===t&&a.setAttribute("Q-disabled","Q-disabled")}),window.addEventListener("Q.History undo is capable",function(e){e.detail.instance===t&&a.removeAttribute("Q-disabled")});const s=i();r.appendChild(s),s.classList.add("Q-circuit-button","Q-circuit-button-redo"),s.setAttribute("title","Redo"),s.setAttribute("Q-disabled","Q-disabled"),s.innerHTML="⟳",window.addEventListener("Q.History redo is depleted",function(e){e.detail.instance===t&&s.setAttribute("Q-disabled","Q-disabled")}),window.addEventListener("Q.History redo is capable",function(e){e.detail.instance===t&&s.removeAttribute("Q-disabled")});const u=i();r.appendChild(u),u.classList.add("Q-circuit-button","Q-circuit-toggle","Q-circuit-toggle-control"),u.setAttribute("title","Create controlled operation"),u.setAttribute("Q-disabled","Q-disabled"),u.innerText="C";const c=i();r.appendChild(c),c.classList.add("Q-circuit-button","Q-circuit-toggle-swap"),c.setAttribute("title","Create swap operation"),c.setAttribute("Q-disabled","Q-disabled"),c.innerText="S";const l=i();n.appendChild(l),l.classList.add("Q-circuit-board-container"),l.addEventListener("mouseleave",function(){Q.Circuit.Editor.unhighlightAll(n)});const d=i();l.appendChild(d),d.classList.add("Q-circuit-board");const m=i();d.appendChild(m),m.classList.add("Q-circuit-board-background");for(let e=0;e<t.bandwidth;e++){const n=i();m.appendChild(n),n.style.position="relative",n.style.gridRowStart=e+2,n.style.gridColumnStart=1,n.style.gridColumnEnd=Q.Circuit.Editor.momentIndexToGridColumn(t.timewidth)+1,n.setAttribute("register-index",e+1);const r=i();n.appendChild(r),r.classList.add("Q-circuit-register-wire")}for(let e=0;e<t.timewidth;e++){const n=i();m.appendChild(n),n.style.gridRowStart=2,n.style.gridRowEnd=Q.Circuit.Editor.registerIndexToGridRow(t.bandwidth)+1,n.style.gridColumnStart=e+3,n.setAttribute("moment-index",e+1)}const h=i();d.appendChild(h),h.classList.add("Q-circuit-board-foreground");const f=i();h.appendChild(f),f.classList.add("Q-circuit-header","Q-circuit-selectall"),f.setAttribute("title","Select all"),f.setAttribute("moment-index","0"),f.setAttribute("register-index","0"),f.innerHTML="&searr;";for(let e=0;e<t.bandwidth;e++){const n=e+1,r=i();h.appendChild(r),r.classList.add("Q-circuit-header","Q-circuit-register-label"),r.setAttribute("title","Register "+n+" of "+t.bandwidth),r.setAttribute("register-index",n),r.style.gridRowStart=Q.Circuit.Editor.registerIndexToGridRow(n),r.innerText=n}const p=i();h.appendChild(p),p.classList.add("Q-circuit-header","Q-circuit-register-add"),p.setAttribute("title","Add register"),p.style.gridRowStart=Q.Circuit.Editor.registerIndexToGridRow(t.bandwidth+1),p.innerText="+";for(let e=0;e<t.timewidth;e++){const n=e+1,r=i();h.appendChild(r),r.classList.add("Q-circuit-header","Q-circuit-moment-label"),r.setAttribute("title","Moment "+n+" of "+t.timewidth),r.setAttribute("moment-index",n),r.style.gridColumnStart=Q.Circuit.Editor.momentIndexToGridColumn(n),r.innerText=n}const g=i();h.appendChild(g),g.classList.add("Q-circuit-header","Q-circuit-moment-add"),g.setAttribute("title","Add moment"),g.style.gridColumnStart=Q.Circuit.Editor.momentIndexToGridColumn(t.timewidth+1),g.innerText="+",t.qubits.forEach(function(t,e){const n=e+1,r=i();r.classList.add("Q-circuit-header","Q-circuit-input"),r.setAttribute("title",`Qubit #${n} starting value`),r.setAttribute("register-index",n),r.style.gridRowStart=Q.Circuit.Editor.registerIndexToGridRow(n),r.innerText=t.beta.toText(),h.appendChild(r)}),t.operations.forEach(function(t){Q.Circuit.Editor.set(n,t)}),n.addEventListener("mousedown",Q.Circuit.Editor.onPointerPress),n.addEventListener("touchstart",Q.Circuit.Editor.onPointerPress),window.addEventListener("Q.Circuit.set$",Q.Circuit.Editor.prototype.onExternalSet.bind(this)),window.addEventListener("Q.Circuit.clear$",Q.Circuit.Editor.prototype.onExternalClear.bind(this));const b=document.createElement("p");n.appendChild(b),b.innerHTML=`\n\t\tThis circuit is accessible in your \n\t\t<a href="index.html#Open_your_JavaScript_console" target="_blank">JavaScript console</a>\n\t\tas <code>$('#${this.domId}').circuit</code>`,Q.log(.5,`\n\nCreated a DOM interface for $('#${this.domId}').circuit\n\n`,t.toDiagram(),"\n\n\n")},Q.Circuit.toDom=function(t,e){return new Q.Circuit.Editor(t,e).domElement},Q.Circuit.prototype.toDom=function(t){return new Q.Circuit.Editor(this,t).domElement},Object.assign(Q.Circuit.Editor,{index:0,help:function(){return Q.help(this)},dragEl:null,gridColumnToMomentIndex:function(t){return+t-2},momentIndexToGridColumn:function(t){return t+2},gridRowToRegisterIndex:function(t){return+t-1},registerIndexToGridRow:function(t){return t+1},gridSize:4,pointToGrid:function(t){const e=parseFloat(getComputedStyle(document.documentElement).fontSize);return 1+Math.floor(t/(e*Q.Circuit.Editor.gridSize))},gridToPoint:function(t){return parseFloat(getComputedStyle(document.documentElement).fontSize)*Q.Circuit.Editor.gridSize*(t-1)},getInteractionCoordinates:function(t,e){return"string"!=typeof e&&(e="client"),t.changedTouches&&t.changedTouches.length?{x:t.changedTouches[0][e+"X"],y:t.changedTouches[0][e+"Y"]}:{x:t[e+"X"],y:t[e+"Y"]}},createPalette:function(t){"string"==typeof t&&(t=document.getElementById(t));const e=t instanceof HTMLElement?t:document.createElement("div"),i=function(t,e){const i=t+Math.random()*(e-t);return Math.floor(2*Math.random())?i:-i};return e.classList.add("Q-circuit-palette"),"HXYZPT*".split("").forEach(function(t){const n=Q.Gate.findBySymbol(t),r=document.createElement("div");e.appendChild(r),r.classList.add("Q-circuit-operation"),r.classList.add("Q-circuit-operation-"+n.nameCss),r.setAttribute("gate-symbol",t),r.setAttribute("title",n.name);const o=document.createElement("div");r.appendChild(o),o.classList.add("Q-circuit-operation-tile"),t!==Q.Gate.CURSOR.symbol&&(o.innerText=t),["before","after"].forEach(function(t){o.style.setProperty("--Q-"+t+"-rotation",i(.5,4)+"deg"),o.style.setProperty("--Q-"+t+"-x",i(1,4)+"px"),o.style.setProperty("--Q-"+t+"-y",i(1,3)+"px")})}),e.addEventListener("mousedown",Q.Circuit.Editor.onPointerPress),e.addEventListener("touchstart",Q.Circuit.Editor.onPointerPress),e}}),Q.Circuit.Editor.prototype.onExternalClear=function(t){t.detail.circuit===this.circuit&&Q.Circuit.Editor.clear(this.domElement,{momentIndex:t.detail.momentIndex,registerIndices:t.detail.registerIndices})},Q.Circuit.Editor.clear=function(t,e){const i=e.momentIndex;e.registerIndices.forEach(function(e){Array.from(t.querySelectorAll(`[moment-index="${i}"]`+`[register-index="${e}"]`)).forEach(function(t){t.parentNode.removeChild(t)})})},Q.Circuit.Editor.prototype.onExternalSet=function(t){t.detail.circuit===this.circuit&&Q.Circuit.Editor.set(this.domElement,t.detail.operation)},Q.Circuit.Editor.set=function(t,e){const i=t.querySelector(".Q-circuit-board-background"),n=t.querySelector(".Q-circuit-board-foreground");t.circuit,t.circuit.operations.indexOf(e);e.registerIndices.forEach(function(t,r){const o=document.createElement("div");n.appendChild(o),o.classList.add("Q-circuit-operation","Q-circuit-operation-"+e.gate.nameCss),o.setAttribute("gate-symbol",e.gate.symbol),o.setAttribute("gate-index",e.gate.index),o.setAttribute("moment-index",e.momentIndex),o.setAttribute("register-index",t),o.setAttribute("register-array-index",r),o.setAttribute("is-controlled",e.isControlled),o.setAttribute("title",e.gate.name),o.style.gridColumnStart=Q.Circuit.Editor.momentIndexToGridColumn(e.momentIndex),o.style.gridRowStart=Q.Circuit.Editor.registerIndexToGridRow(t);const a=document.createElement("div");o.appendChild(a),a.classList.add("Q-circuit-operation-tile"),e.gate.symbol!==Q.Gate.CURSOR.symbol&&(a.innerText=e.gate.symbol),e.registerIndices.length>1&&(o.setAttribute("register-indices",e.registerIndices),o.setAttribute("register-indices-index",r),o.setAttribute("sibling-indices",e.registerIndices.filter(function(e){return t!==e})),e.registerIndices.forEach(function(t,n){if(n<e.registerIndices.length-1){const r=e.registerIndices[n+1],o=Math.abs(r-t),a=Math.min(t,r),s=Math.max(t,r),u=document.createElement("div"),c=document.createElement("div");i.appendChild(u),u.setAttribute("moment-index",e.momentIndex),u.setAttribute("register-index",t),u.classList.add("Q-circuit-operation-link-container"),u.style.gridRowStart=Q.Circuit.Editor.registerIndexToGridRow(a),u.style.gridRowEnd=Q.Circuit.Editor.registerIndexToGridRow(s+1),u.style.gridColumn=Q.Circuit.Editor.momentIndexToGridColumn(e.momentIndex),u.appendChild(c),c.classList.add("Q-circuit-operation-link"),o>1&&c.classList.add("Q-circuit-operation-link-curved")}}),e.isControlled&&0===r?(o.classList.add("Q-circuit-operation-control"),o.setAttribute("title","Control"),a.innerText=""):o.classList.add("Q-circuit-operation-target"))})},Q.Circuit.Editor.isValidControlCandidate=function(t){const e=Array.from(t.querySelectorAll(".Q-circuit-cell-selected"));if(e.length<2)return!1;const i=e.reduce(function(t,e){return t[e.getAttribute("moment-index")]=!0,t},{});if(Object.keys(i).length>1)return!1;if(!0!==e.reduce(function(t,i){const n=i.getAttribute("register-indices");if(!n)return t;const r=n.split(",").map(function(t){return+t}).length,o=e.reduce(function(t,e){return e.getAttribute("register-indices")===n&&t.push(e),t},[]).length;return t&&o===r},!0))return!1;const n=e.reduce(function(t,e){const i=e.getAttribute("gate-symbol");return Q.isUsefulInteger(t[i])?t[i]++:t[i]=1,t},{}),{totalControlled:r,totalNotControlled:o}=e.reduce(function(t,e){return"true"===e.getAttribute("is-controlled")?t.totalControlled++:t.totalNotControlled++,t},{totalControlled:0,totalNotControlled:0});return 1===n[Q.Gate.CURSOR.symbol]&&2===Object.keys(n).length&&o===e.length||void 0===n[Q.Gate.CURSOR.symbol]&&1===Object.keys(n).length&&r>0&&o>0},Q.Circuit.Editor.createControl=function(t){if(!0!==Q.Circuit.Editor.isValidControlCandidate(t))return this;const e=t.circuit,i=Array.from(t.querySelectorAll(".Q-circuit-cell-selected")),n=i.find(function(t){return"true"===t.getAttribute("is-controlled")&&"0"===t.getAttribute("register-array-index")})||i.find(function(t){return t.getAttribute("gate-symbol")===Q.Gate.CURSOR.symbol}),r=i.reduce(function(t,e){return e!==n&&t.push(e),t},[]);return e.history.createEntry$(),i.forEach(function(t){e.clear$(+t.getAttribute("moment-index"),+t.getAttribute("register-index"))}),e.set$(r[0].getAttribute("gate-symbol"),+n.getAttribute("moment-index"),[+n.getAttribute("register-index")].concat(r.reduce(function(t,e){return t.push(+e.getAttribute("register-index")),t},[]))),Q.Circuit.Editor.onSelectionChanged(t),Q.Circuit.Editor.onCircuitChanged(t),this},Q.Circuit.Editor.isValidSwapCandidate=function(t){const e=Array.from(t.querySelectorAll(".Q-circuit-cell-selected"));return 2===e.length&&(areBothCursors=e.every(function(t){return t.getAttribute("gate-symbol")===Q.Gate.CURSOR.symbol}),!!areBothCursors)},Q.Circuit.Editor.createSwap=function(t){if(!0!==Q.Circuit.Editor.isValidSwapCandidate(t))return this;const e=Array.from(t.querySelectorAll(".Q-circuit-cell-selected")),i=+e[0].getAttribute("moment-index");return registerIndices=e.reduce(function(t,e){return t.push(+e.getAttribute("register-index")),t},[]),circuit=t.circuit,circuit.history.createEntry$(),e.forEach(function(t){circuit.clear$(+t.getAttribute("moment-index"),+t.getAttribute("register-index"))}),circuit.set$(Q.Gate.SWAP,i,registerIndices),Q.Circuit.Editor.onSelectionChanged(t),Q.Circuit.Editor.onCircuitChanged(t),this},Q.Circuit.Editor.onSelectionChanged=function(t){const e=t.querySelector(".Q-circuit-toggle-control");Q.Circuit.Editor.isValidControlCandidate(t)?e.removeAttribute("Q-disabled"):e.setAttribute("Q-disabled",!0);const i=t.querySelector(".Q-circuit-toggle-swap");Q.Circuit.Editor.isValidSwapCandidate(t)?i.removeAttribute("Q-disabled"):i.setAttribute("Q-disabled",!0)},Q.Circuit.Editor.onCircuitChanged=function(t){const e=t.circuit;window.dispatchEvent(new CustomEvent("Q gui altered circuit",{detail:{circuit:e}}))},Q.Circuit.Editor.unhighlightAll=function(t){Array.from(t.querySelectorAll(".Q-circuit-board-background > div,.Q-circuit-board-foreground > div")).forEach(function(t){t.classList.remove("Q-circuit-cell-highlighted")})},Q.Circuit.Editor.onPointerMove=function(t){const{x:e,y:i}=Q.Circuit.Editor.getInteractionCoordinates(t),n=document.elementsFromPoint(e,i),r=n.find(function(t){return t.classList.contains("Q-circuit-board-container")});if(null!==Q.Circuit.Editor.dragEl&&(t.preventDefault(),Q.Circuit.Editor.dragEl.style.left=e+window.pageXOffset+Q.Circuit.Editor.dragEl.offsetX+"px",Q.Circuit.Editor.dragEl.style.top=i+window.pageYOffset+Q.Circuit.Editor.dragEl.offsetY+"px",!r&&Q.Circuit.Editor.dragEl.circuitEl?Q.Circuit.Editor.dragEl.classList.add("Q-circuit-clipboard-danger"):Q.Circuit.Editor.dragEl.classList.remove("Q-circuit-clipboard-danger")),!r)return;const o=r.closest(".Q-circuit");if(o.classList.contains("Q-circuit-locked"))return;Array.from(r.querySelectorAll("\n\n\t\t.Q-circuit-board-background > div, \n\t\t.Q-circuit-board-foreground > div\n\t\n\t")).forEach(function(t){t.classList.remove("Q-circuit-cell-highlighted")});const a=n.find(function(t){return"sticky"===window.getComputedStyle(t).position&&(null!==t.getAttribute("moment-index")||null!==t.getAttribute("register-index"))}),s=function(t){Array.from(r.querySelectorAll(t)).forEach(function(t){t.classList.add("Q-circuit-cell-highlighted")})};if(a){const t=a.getAttribute("moment-index"),e=a.getAttribute("register-index");return null===t?void s(`div[register-index="${e}"]`):null===e?void s(`div[moment-index="${t}"]`):void s("\n\n\t\t\t.Q-circuit-board-background > div[moment-index],\n\t\t\t.Q-circuit-board-foreground > .Q-circuit-operation\n\n\t\t")}const u=r.getBoundingClientRect(),c=e-u.left+r.scrollLeft+1,l=i-u.top+r.scrollTop+1,d=Q.Circuit.Editor.pointToGrid(c),m=Q.Circuit.Editor.pointToGrid(l),h=Q.Circuit.Editor.gridColumnToMomentIndex(d),f=Q.Circuit.Editor.gridRowToRegisterIndex(m);h>o.circuit.timewidth||f>o.circuit.bandwidth||h<1||f<1||s(`\n\n\t\tdiv[moment-index="${h}"],\n\t\tdiv[register-index="${f}"]\n\t`)},Q.Circuit.Editor.onPointerPress=function(t){if(null!==Q.Circuit.Editor.dragEl)return void Q.Circuit.Editor.onPressEnded(t);const e=t.target,i=e.closest(".Q-circuit"),n=e.closest(".Q-circuit-palette");if(!i&&!n)return;dragEl=document.createElement("div"),dragEl.classList.add("Q-circuit-clipboard");const{x:r,y:o}=Q.Circuit.Editor.getInteractionCoordinates(t);if(i){const n=i.circuit,s=i.classList.contains("Q-circuit-locked"),u=e.closest(".Q-circuit-toggle-lock");if(u)return s?(i.classList.remove("Q-circuit-locked"),u.innerText="🔓"):(i.classList.add("Q-circuit-locked"),u.innerText="🔒",Q.Circuit.Editor.unhighlightAll(i)),t.preventDefault(),void t.stopPropagation();if(s)return void Q.warn("User attempted to interact with a circuit editor but it was locked.");const c=e.closest("\n\n\t\t\t.Q-circuit-board-foreground > div,\n\t\t\t.Q-circuit-palette > div\n\t\t"),l=e.closest(".Q-circuit-button-undo"),d=e.closest(".Q-circuit-button-redo"),m=e.closest(".Q-circuit-toggle-control"),h=e.closest(".Q-circuit-toggle-swap"),f=e.closest(".Q-circuit-moment-add"),p=e.closest(".Q-circuit-register-add");if(!(c||l||d||m||h||f||p))return;if(t.preventDefault(),t.stopPropagation(),l&&n.history.undo$()&&(Q.Circuit.Editor.onSelectionChanged(i),Q.Circuit.Editor.onCircuitChanged(i)),d&&n.history.redo$()&&(Q.Circuit.Editor.onSelectionChanged(i),Q.Circuit.Editor.onCircuitChanged(i)),m&&Q.Circuit.Editor.createControl(i),h&&Q.Circuit.Editor.createSwap(i),f&&console.log("→ Add moment"),p&&console.log("→ Add register"),!c)return;const g=+c.getAttribute("moment-index"),b=+c.getAttribute("register-index"),x=Q.Circuit.Editor.momentIndexToGridColumn(g),C=Q.Circuit.Editor.registerIndexToGridRow(b),y=e.closest(".Q-circuit-selectall"),w=e.closest(".Q-circuit-register-label"),E=e.closest(".Q-circuit-moment-label"),I=e.closest(".Q-circuit-input"),M=e.closest(".Q-circuit-operation");if(I)return void console.log("→ Edit input Qubit value at",b);function a(t){const e=Array.from(i.querySelectorAll(t));e.reduce(function(t,e){return t+=+e.classList.contains("Q-circuit-cell-selected")},0)===e.length?e.forEach(function(t){t.classList.remove("Q-circuit-cell-selected")}):e.forEach(function(t){t.classList.add("Q-circuit-cell-selected")}),Q.Circuit.Editor.onSelectionChanged(i)}if(y)return void a(".Q-circuit-operation");if(E)return void a(`.Q-circuit-operation[moment-index="${g}"]`);if(w)return void a(`.Q-circuit-operation[register-index="${b}"]`);if(!M)return;M.classList.contains("Q-circuit-cell-selected")?M.wasSelected=!0:M.wasSelected=!1,M.classList.add("Q-circuit-cell-selected");const N=Array.from(i.querySelectorAll(".Q-circuit-cell-selected"));dragEl.circuitEl=i,dragEl.originEl=i.querySelector(".Q-circuit-board-foreground"),dragEl.columnIndexOffset=1,dragEl.rowIndexOffset=1;let A=1/0,v=1/0;N.forEach(function(t){const e=+t.getAttribute("moment-index"),i=+t.getAttribute("register-index"),n=Q.Circuit.Editor.momentIndexToGridColumn(e),r=Q.Circuit.Editor.registerIndexToGridRow(i);A=Math.min(A,n),v=Math.min(v,r),t.classList.remove("Q-circuit-cell-selected"),t.origin={momentIndex:e,registerIndex:i,columnIndex:n,rowIndex:r},dragEl.appendChild(t)}),N.forEach(function(t){const e=1+t.origin.columnIndex-A,i=1+t.origin.rowIndex-v;t.style.gridColumn=e,t.style.gridRow=i,t.origin.columnIndex===x&&t.origin.rowIndex===C&&(dragEl.columnIndexOffset=e,dragEl.rowIndexOffset=i)});const S=i.querySelector(".Q-circuit-board-foreground").getBoundingClientRect(),$=Q.Circuit.Editor.gridToPoint(A),T=Q.Circuit.Editor.gridToPoint(v);dragEl.offsetX=S.left+$-r,dragEl.offsetY=S.top+T-o,dragEl.momentIndex=g,dragEl.registerIndex=b}else if(n){const i=e.closest(".Q-circuit-operation");if(!i)return;const r=i.getBoundingClientRect(),{x:o,y:a}=Q.Circuit.Editor.getInteractionCoordinates(t);dragEl.appendChild(i.cloneNode(!0)),dragEl.originEl=n,dragEl.offsetX=r.left-o,dragEl.offsetY=r.top-a}dragEl.timestamp=Date.now(),document.body.appendChild(dragEl),Q.Circuit.Editor.dragEl=dragEl,Q.Circuit.Editor.onPointerMove(t)},Q.Circuit.Editor.onPointerRelease=function(t){if(null===Q.Circuit.Editor.dragEl)return;t.preventDefault(),t.stopPropagation();const{x:e,y:i}=Q.Circuit.Editor.getInteractionCoordinates(t),n=document.elementsFromPoint(e,i).find(function(t){return t.classList.contains("Q-circuit-board-container")}),r=function(){Q.Circuit.Editor.dragEl.circuitEl&&(Array.from(Q.Circuit.Editor.dragEl.children).forEach(function(t){Q.Circuit.Editor.dragEl.originEl.appendChild(t),t.style.gridColumn=t.origin.columnIndex,t.style.gridRow=t.origin.rowIndex,!0===t.wasSelected?t.classList.remove("Q-circuit-cell-selected"):t.classList.add("Q-circuit-cell-selected")}),Q.Circuit.Editor.onSelectionChanged(Q.Circuit.Editor.dragEl.circuitEl)),document.body.removeChild(Q.Circuit.Editor.dragEl),Q.Circuit.Editor.dragEl=null};if(!n){if(Q.Circuit.Editor.dragEl.circuitEl){const t=Q.Circuit.Editor.dragEl.circuitEl;originCircuit=t.circuit,originCircuit.history.createEntry$(),Array.from(Q.Circuit.Editor.dragEl.children).forEach(function(t){originCircuit.clear$(t.origin.momentIndex,t.origin.registerIndex)}),Q.Circuit.Editor.onSelectionChanged(t),Q.Circuit.Editor.onCircuitChanged(t)}let t=Q.Circuit.Editor.dragEl;return Q.Circuit.Editor.dragEl=null,t.classList.add("Q-circuit-clipboard-destroy"),void setTimeout(function(){document.body.removeChild(t),t=null},500)}const o=n.closest(".Q-circuit");if(o.classList.contains("Q-circuit-locked"))return void r();const a=o.circuit,s=n.getBoundingClientRect(),u=e-s.left+n.scrollLeft,c=i-s.top+n.scrollTop,l=Q.Circuit.Editor.gridColumnToMomentIndex(Q.Circuit.Editor.pointToGrid(u)),d=Q.Circuit.Editor.gridRowToRegisterIndex(Q.Circuit.Editor.pointToGrid(c));o.querySelector(".Q-circuit-board-foreground");if(Q.Circuit.Editor.dragEl.circuitEl===o&&Q.Circuit.Editor.dragEl.momentIndex===l&&Q.Circuit.Editor.dragEl.registerIndex===d)return void r();if(l<1||l>a.timewidth||d<1||d>a.bandwidth)return void r();const m=Array.from(Q.Circuit.Editor.dragEl.children),h=l-Q.Circuit.Editor.dragEl.momentIndex,f=d-Q.Circuit.Editor.dragEl.registerIndex,p=[];if(a.history.createEntry$(),m.forEach(function(t,e){let i=l,n=d;Q.Circuit.Editor.dragEl.circuitEl&&(i+=t.origin.momentIndex-Q.Circuit.Editor.dragEl.momentIndex,n+=t.origin.registerIndex-Q.Circuit.Editor.dragEl.registerIndex);const r=t.getAttribute("register-indices");if(r){const a=r.split(",").map(function(t){return+t}),s=Array.from(Q.Circuit.Editor.dragEl.querySelectorAll(`[moment-index="${t.origin.momentIndex}"]`+`[register-indices="${r}"]`)).sort(function(t,e){return+t.getAttribute("register-indices-index")-+e.getAttribute("register-indices-index")}),u=Array.from(Q.Circuit.Editor.dragEl.circuitEl.querySelectorAll(`[moment-index="${t.origin.momentIndex}"]`+`[register-indices="${r}"]`)).filter(function(t,e){return!s.includes(t)}),c=Q.Circuit.Editor.dragEl.querySelector(`[moment-index="${t.origin.momentIndex}"]`+`[register-index="${a[1]}"]`),l=c?c.getAttribute("gate-symbol"):t.getAttribute("gate-symbol");if(m.forEach(function(t){Q.Circuit.Editor.dragEl.circuitEl.circuit.clear$(t.origin.momentIndex,t.origin.registerIndex)}),a.length===s.length)p.push([l,i,a.map(function(e){const i=e-t.origin.registerIndex;return n=d,Q.Circuit.Editor.dragEl.circuitEl&&(n+=t.origin.registerIndex-Q.Circuit.Editor.dragEl.registerIndex+i),n})]);else if(Q.Circuit.Editor.dragEl.circuitEl===o&&i===t.origin.momentIndex){const e=a.reduce(function(t,e,i){return t[e]=i,t},{});s.forEach(function(t){const i=+t.getAttribute("register-index");delete e[i]}),s.forEach(function(t){const i=+t.getAttribute("register-index");Q.Circuit.Editor.dragEl.registerIndex;e[i+f]=+t.getAttribute("register-indices-index")});const n=Object.entries(e).reduce(function(t,e,i){return t[+e[1]]=+e[0],t},[]).filter(function(t){return Q.isUsefulInteger(t)});p.push([t.getAttribute("gate-symbol"),i,n])}else u.forEach(function(t,e){p.push([+t.getAttribute("register-indices-index")?l:Q.Gate.NOOP,+t.getAttribute("moment-index"),+t.getAttribute("register-index")])}),s.forEach(function(t){p.push([+t.getAttribute("register-indices-index")?l:Q.Gate.NOOP,+t.getAttribute("moment-index")+h,+t.getAttribute("register-index")+f])});let g=e+1;for(;g<m.length;){const t=m[g];t.getAttribute("gate-symbol")===l&&t.getAttribute("register-indices")===r?m.splice(g,1):g++}}else Q.Circuit.Editor.dragEl.circuitEl&&m.forEach(function(t){Q.Circuit.Editor.dragEl.circuitEl.circuit.clear$(t.origin.momentIndex,t.origin.registerIndex)}),p.push([t.getAttribute("gate-symbol"),i,[n]])}),p.forEach(function(t){a.set$.apply(a,t)}),Q.Circuit.Editor.onSelectionChanged(o),Q.Circuit.Editor.onCircuitChanged(o),Q.Circuit.Editor.dragEl.circuitEl&&Q.Circuit.Editor.dragEl.circuitEl!==o){const t=Q.Circuit.Editor.dragEl.circuitEl;Q.Circuit.Editor.onSelectionChanged(t),Q.Circuit.Editor.onCircuitChanged(t)}document.body.removeChild(Q.Circuit.Editor.dragEl),Q.Circuit.Editor.dragEl=null},window.addEventListener("DOMContentLoaded",function(t){window.addEventListener("mousemove",Q.Circuit.Editor.onPointerMove),window.addEventListener("touchmove",Q.Circuit.Editor.onPointerMove),window.addEventListener("mouseup",Q.Circuit.Editor.onPointerRelease),window.addEventListener("touchend",Q.Circuit.Editor.onPointerRelease)})}]);